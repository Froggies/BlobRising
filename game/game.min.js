// Input 0
(function(){this.app=this.app||{}}).apply(window);var Sylvester={precision:0.001,Vector:function(){},Matrix:function(){}};Sylvester.Matrix.create=function(d){return(new Sylvester.Matrix).setElements(d)};var $M=Sylvester.Matrix.create;
Sylvester.Matrix.Rotation=function(d,b){if(!b)return Sylvester.Matrix.create([[Math.cos(d),-Math.sin(d)],[Math.sin(d),Math.cos(d)]]);var a=b.dup();if(3!==a.elements.length)return null;var e=a.modulus(),c=a.elements[0]/e,j=a.elements[1]/e,a=a.elements[2]/e,e=Math.sin(d),f=Math.cos(d),g=1-f;return Sylvester.Matrix.create([[g*c*c+f,g*c*j-e*a,g*c*a+e*j],[g*c*j+e*a,g*j*j+f,g*j*a-e*c],[g*c*a-e*j,g*j*a+e*c,g*a*a+f]])};
Sylvester.Matrix.prototype={dup:function(){return Sylvester.Matrix.create(this.elements)},setElements:function(d){var b,a=d.elements||d;if(a[0]&&"undefined"!==typeof a[0][0]){d=a.length;for(this.elements=[];d--;){b=a[d].length;for(this.elements[d]=[];b--;)this.elements[d][b]=a[d][b]}return this}b=a.length;this.elements=[];for(d=0;d<b;d++)this.elements.push([a[d]]);return this}};Sylvester.Vector.create=function(d){return(new Sylvester.Vector).setElements(d)};var $V=Sylvester.Vector.create;
Sylvester.Vector.prototype={forEach:function(d,b){for(var a=this.elements.length,e=0;e<a;e++)d.call(b,this.elements[e],e+1)},angleFrom:function(d){var b=d.elements||d;if(this.elements.length!==b.length)return null;var a=0,e=0,c=0;this.each(function(j,f){a+=j*b[f-1];e+=j*j;c+=b[f-1]*b[f-1]});e=Math.sqrt(e);c=Math.sqrt(c);if(0===e*c)return null;d=a/(e*c);-1>d&&(d=-1);1<d&&(d=1);return Math.acos(d)},rotate:function(d,b){var a,e=null,c,j;d.determinant&&(e=d.elements);switch(this.elements.length){case 2:a=
b.elements||b;if(2!==a.length)return null;e||(e=Sylvester.Matrix.Rotation(d).elements);c=this.elements[0]-a[0];j=this.elements[1]-a[1];return Sylvester.Vector.create([a[0]+e[0][0]*c+e[0][1]*j,a[1]+e[1][0]*c+e[1][1]*j]);case 3:if(!b.direction)return null;var f=b.pointClosestTo(this).elements;e||(e=Sylvester.Matrix.Rotation(d,b.direction).elements);c=this.elements[0]-f[0];j=this.elements[1]-f[1];a=this.elements[2]-f[2];return Sylvester.Vector.create([f[0]+e[0][0]*c+e[0][1]*j+e[0][2]*a,f[1]+e[1][0]*
c+e[1][1]*j+e[1][2]*a,f[2]+e[2][0]*c+e[2][1]*j+e[2][2]*a]);default:return null}},setElements:function(d){this.elements=(d.elements||d).slice();return this}};Sylvester.Vector.prototype.x=Sylvester.Vector.prototype.multiply;Sylvester.Vector.prototype.each=Sylvester.Vector.prototype.forEach;
var maps=[{mapName:"Semi arc",menuRotate:{className:"Rotate",nb:0},menuMagnet:{className:"Magnet",nb:1},staticEntities:[{className:"Wall",shape:{x:400,y:300,width:180}},{className:"Magnet",shape:{x:350,y:470}},{className:"Magnet",shape:{x:680,y:450}},{className:"Magnet",shape:{x:820,y:300}},{className:"Magnet",shape:{x:735,y:100}}],startSource:{degreeBlob:50,shape:{x:150,y:350}},endWell:{shape:{x:200,y:100}}},{mapName:"Simple effect",menuRotate:{className:"Rotate",nb:3},menuMagnet:{className:"Magnet",
nb:1},staticEntities:[{className:"Well",shape:{x:300,y:200}},{className:"Wall",shape:{x:550,y:200,height:180}}],startSource:{degreeBlob:40,shape:{x:50,y:100}},endWell:{shape:{x:500,y:250}}},{mapName:"BLOB",menuRotate:{className:"Rotate",nb:3},menuMagnet:{className:"Magnet",nb:5},staticEntities:[{className:"Wall",shape:{x:100,y:100,width:150,height:35}},{className:"Wall",shape:{x:100,y:100,width:35,height:300}},{className:"Wall",shape:{x:100,y:250,width:150,height:35}},{className:"Wall",shape:{x:100,
y:400,width:150,height:35}},{className:"Wall",shape:{x:250,y:100,width:35,height:335}},{className:"Wall",shape:{x:350,y:100,width:35,height:300}},{className:"Wall",shape:{x:350,y:400,width:150,height:35}},{className:"Wall",shape:{x:550,y:100,width:150,height:35}},{className:"Wall",shape:{x:550,y:100,width:35,height:300}},{className:"Wall",shape:{x:550,y:400,width:150,height:35}},{className:"Wall",shape:{x:700,y:100,width:35,height:335}},{className:"Wall",shape:{x:800,y:100,width:150,height:35}},{className:"Wall",
shape:{x:800,y:100,width:35,height:300}},{className:"Wall",shape:{x:800,y:250,width:150,height:35}},{className:"Wall",shape:{x:800,y:400,width:150,height:35}},{className:"Wall",shape:{x:950,y:100,width:35,height:335}}],startSource:{degreeBlob:0,firstAgeForLostBlob:700,shape:{x:10,y:10}},endWell:{shape:{x:850,y:500}}},{mapName:"Jail",menuRotate:{className:"Rotate",nb:4},menuMagnet:{className:"Magnet",nb:4},staticEntities:[{className:"Wall",shape:{x:200,y:10,width:35,height:300}},{className:"Wall",
shape:{x:200,y:10,width:35,height:300}},{className:"Wall",shape:{x:310,y:280,width:200,height:35}},{className:"Wall",shape:{x:650,y:280,width:260,height:35}},{className:"Wall",shape:{x:570,y:10,width:35,height:230}},{className:"Well",shape:{x:400,y:70}},{className:"Well",shape:{x:800,y:450}}],startSource:{degreeBlob:55,firstAgeForLostBlob:800,shape:{x:50,y:50}},endWell:{shape:{x:800,y:100}}},{mapName:"Patience",menuRotate:{className:"Rotate",nb:2},menuMagnet:{className:"Magnet",nb:10},staticEntities:[{className:"Wall",
shape:{x:500,y:0,width:5,height:100}},{className:"Wall",shape:{x:500,y:125,width:5,height:100}},{className:"Wall",shape:{x:500,y:245,width:5,height:100}},{className:"Wall",shape:{x:500,y:365,width:5,height:100}},{className:"Wall",shape:{x:500,y:485,width:5,height:100}}],startSource:{degreeBlob:0,firstAgeForLostBlob:300,shape:{x:50,y:250}},endWell:{shape:{x:750,y:250}}},{mapName:"Inverse",menuRotate:{className:"Rotate",nb:10},menuMagnet:{className:"Magnet",nb:10},staticEntities:[{className:"Wall",
shape:{x:500,y:150,width:35,height:300}},{className:"Wall",shape:{x:700,y:150,width:300,height:35}},{className:"Wall",shape:{x:700,y:415,width:300,height:35}},{className:"Wall",shape:{x:10,y:150,width:300,height:35}},{className:"Wall",shape:{x:10,y:415,width:300,height:35}},{className:"Well",shape:{x:500,y:150}},{className:"Well",shape:{x:500,y:415}}],startSource:{degreeBlob:0,firstAgeForLostBlob:500,shape:{x:550,y:250}},endWell:{shape:{x:400,y:250}}}];
(function(){app.js={};app.js.isDefined=function(b){return"undefined"!==typeof b&&null!==b};var d={}.hasOwnProperty;app.js.inherit=function(b,a){function e(){this.constructor=b}for(var c in a)d.call(a,c)&&(b[c]=a[c]);e.prototype=a.prototype;b.prototype=new e;b.parent=a.prototype;return b};app.js.stringToClass=function(b){for(var b=b.split("."),a=window||this,e=0,c=b.length;e<c;e++)a=a[b[e]];if("function"!==typeof a)throw Error("function not found");return a};app.js.deserialize=function(b,a){var e=
{};app.js.isDefined(b)&&app.js.isDefined(b.className)?e=new (app.js.stringToClass("app.entities."+b.className)):app.js.isDefined(a)&&(e=a);for(var c in b)if(b[c]instanceof Array){app.js.isDefined(e[c])||(e[c]=[]);for(var j in b[c])e[c].push(app.js.deserialize(b[c][j]))}else e[c]="object"==typeof b[c]?app.js.deserialize(b[c],e[c]):b[c];return e};app.js.clone=function(b){return app.js.deserialize(b)};app.js.arrayRemove=function(b,a){if(!app.js.isDefined(b)||!app.js.isDefined(a))console.trace();else{var e=
b.indexOf(a);-1!=e&&b.splice(e,1);return-1!=e}}})();
(function(){app.shapes=app.shapes||{};var d=app.shapes,b=function(a,e,c,b,f,d,h,i){this.x=a;this.y=e;this.width=c;this.height=b;this.color=f;this.urlImage=d;this.urlPattern=h;this.urlSprite=i};b.prototype.drawImage=function(a,e){var c=new Image;if(app.js.isDefined(this.urlSprite)){c.src=this.urlSprite;var b=0,f=180*e.radian/Math.PI;0<f&&45>=f?b=132:45<f&&90>=f?b=154:90<f&&135>=f?b=0:135<f&&180>=f?b=22:-135>=f&&-180<f?b=44:-90>=f&&-135<f?b=66:-45>=f&&-90<f?b=88:0>=f&&-45<f&&(b=110);a.drawImage(c,0,
b,20,20,this.x,this.y,this.width,this.height)}else c.src=this.urlImage,a.drawImage(c,this.x,this.y,this.width,this.height)};d.Shape=b})();
(function(){var d=app.js.inherit,b=app.shapes,a=function(){a.parent.constructor.apply(this,arguments)};d(a,app.shapes.Shape);a.prototype.draw=function(e,c){e.save();if(app.js.isDefined(this.urlImage)||app.js.isDefined(this.urlSprite))a.parent.drawImage.call(this,e,c);else if(app.js.isDefined(this.urlPattern)){var b=new Image;b.src=this.urlPattern;b=e.createPattern(b,"repeat");e.fillStyle=this.color;e.fillRect(this.x,this.y,this.width,this.height);e.fillStyle=b;e.fillRect(this.x,this.y,this.width,
this.height);e.strokeStyle="#626163";e.strokeRect(this.x,this.y,this.width,this.height)}e.restore()};b.Rectangle=a})();
(function(){var d=app.js.inherit,b=app.shapes,a=function(e,c,b,f,d,h){a.parent.constructor.apply(this,arguments)};d(a,app.shapes.Shape);a.prototype.draw=function(e){e.save();e.beginPath();e.arc(this.x,this.y,this.width/2,0,2*Math.PI,!1);e.closePath();app.js.isDefined(this.urlImage)&&a.parent.drawImage.call(this,e);e.strokeStyle=this.color;e.stroke();e.restore()};a.prototype.getRadius=function(){return this.width/2};b.Ellipse=a})();
(function(){app.physics={};var d=app.js.isDefined,b=app.physics,a=function(a,c,b){this.entity=a;this.speed=c;this.radian=Math.PI*b/180;a=Number(Math.cos(this.radian).toFixed(2));c=Number(Math.sin(this.radian).toFixed(2));this.angle=$V([a,c])};a.prototype.update=function(a,c,b){var d=this.entity.shape.x,g=this.entity.shape.y,h=this.entity.shape.height,i=this.entity.shape.width,k=g+this.speed*this.angle.elements[1],l=Number((d+this.speed*this.angle.elements[0]).toFixed(2)),k=Number(k.toFixed(2));this.setCoordinate(l,
k);0>=g?this.entity.dead(a):0>=d?this.entity.dead(a):0>=g||g>=b-h?this.entity.dead(a):d>=c-i&&this.entity.dead(a)};a.prototype.setCoordinate=function(a,c){this.entity.shape.x=a;this.entity.shape.y=c};a.prototype.attractTo=function(a){this.angle=this.calculAngle(this.entity.shape,a)};a.prototype.calculAngle=function(a,c){var b=Math.atan2(c.y-a.y,c.x-a.x)/(Math.PI/180);this.radian=Math.PI*b/180;var b=Math.cos(this.radian),d=Math.sin(this.radian);return $V([b,d])};a.prototype.rotateAround=function(a){var c=
this.entity.shape.x,b=this.entity.shape.y,d=$V([a.x,a.y]);relativX=a.x-c;relativY=a.y-b;this.radian=$V([relativX,relativY]).angleFrom(d);var a=Number(Math.cos(this.radian+Math.PI/2).toFixed(2)),g=Number(Math.sin(this.radian+Math.PI/2).toFixed(2));this.angle=$V([a,g]);a=this.speed*Math.PI/180;c=$V([c,b]).rotate(a,d);this.setCoordinate(c.elements[0],c.elements[1]);this.speed+=0.01};a.prototype.isInRectangle=function(a,c){var b=a.shape.x,d=a.shape.y,g=a.shape.height,h=a.shape.width,i=c.shape.x,k=c.shape.y,
l=c.shape.height;return i+c.shape.width<b||i>b+h||k+l<d||k>d+g?!1:!0};a.prototype.isInRadius=function(a){var c=a.getRadius();if(!d(c)||0>=c)return!1;var b=this.entity.shape.y+this.entity.shape.height/2,f=this.entity.shape.width,g=this.entity.shape.height,h=Math.abs(a.x-(this.entity.shape.x+this.entity.shape.width/2)),a=Math.abs(a.y-b);if(h>f/2+c||a>g/2+c)return!1;if(h<=f/2||a<=g/2)return!0;cornerDistance=Math.pow(h-f/2,2)+Math.pow(a-g/2,2);return cornerDistance<=Math.pow(c,2)};b.Physic=a})();
(function(){app.entities=app.entities||{};var d=app.entities,b=function(){this.age=0;this.imAlive=!0;this.shape=new app.shapes.Rectangle;this.draggable=!1};b.prototype.update=function(a){this.incrementMyAge(a)};b.prototype.draw=function(a){this.shape.draw(a)};b.prototype.incrementMyAge=function(){this.age++};b.prototype.dead=function(a){this.imAlive=!1;app.js.arrayRemove(a.staticEntities,this)};d.Entity=b})();
(function(){var d=app.js.inherit,b=app.entities,a=function(e,c){a.parent.constructor.apply(this);this.maxAge=100;this.shape=new app.shapes.Rectangle(0,0,e,c,"#FF0000",null,null,"img/blobSprite.gif");this.initialWidth=e;this.initialHeight=c};d(a,app.entities.Entity);a.prototype.draw=function(a){this.shape.draw(a,this.physic)};a.prototype.incrementMyAge=function(e){a.parent.incrementMyAge.call(this,e);this.age<this.maxAge&&0<this.shape.width?(this.shape.width=this.initialWidth-this.initialWidth/this.maxAge*
this.age,this.shape.height=this.initialHeight-this.initialHeight/this.maxAge*this.age):this.dead(e)};a.prototype.dead=function(a){this.imAlive=!1;app.js.arrayRemove(a.noneEntities,this)};b.Molecule=a})();
(function(){var d=app.js.inherit,b=app.entities,a=function(e,c,b){a.parent.constructor.apply(this,arguments);this.nbBlob=50;this.maxAge=1E3;this.physic=new app.physics.Physic(this,2,b);this.shape=new app.shapes.Rectangle(0,0,e,c,"#00FF00",null,null,"img/blobSprite.gif");this.timeToLostMolecule=Number((this.maxAge/this.nbBlob).toFixed(0));this.firstAttract=!0};d(a,app.entities.Molecule);a.prototype.update=function(e,c){for(var b=!0,d=!1,g=c.getDeadlyEntities(),h=0;h<g.length;h++){var i=g[h];if(this.physic.isInRectangle(this,
i)&&!1===i.draggable){this.dead(c);b=!1;d=!0;break}}if(!d){g=c.getAttractiveEntities();for(h=0;h<g.length;h++)if(i=g[h],this.physic.isInRadius(i.attraction)&&!1===i.draggable){if("Well"==i.className){this.dead(c);i.nbBlob++;return}8>i.attracted&&(this.firstAttract||(this.physic.angle=$V([this.oldAngle.x,this.oldAngle.y])),this.physic.attractTo(i.attraction),this.firstAttract=i.isDraggable=!1,i.attracted++,d=!0,this.attractedBy=i,this.oldAngle={x:this.physic.angle.elements[0],y:this.physic.angle.elements[1]})}else i.attracted=
0}if(!d){d=c.getOrbitalEntities();for(h=0;h<d.length;h++)i=d[h],this.physic.isInRadius(i.orbit)&&!1===i.draggable&&(this.physic.rotateAround(i.orbit),b=i.isDraggable=!1)}b&&this.physic.update(c,e.canvas.width,e.canvas.height);this.isBirthday()&&0<this.nbBlob&&(this.nbBlob--,c.showNoneEntities&&(b=new app.entities.Molecule(this.shape.width,this.shape.height),b.shape.x=this.shape.x,b.shape.y=this.shape.y,b.physic={radian:this.physic.radian},c.noneEntities.push(b)));a.parent.incrementMyAge.call(this,
c)};a.prototype.isBirthday=function(){return 0==this.age%this.timeToLostMolecule&&this.imAlive};a.prototype.dead=function(a){this.imAlive=!1;a.nbBlobDead++;app.js.arrayRemove(a.blobEntities,this)};b.Blob=a})();
(function(){var d=app.js.inherit,b=app.entities,a=function(){a.parent.constructor.apply(this);this.nbBlob=1;this.maxAge=this.lostTime=100;this.degreeBlob=120;this.firstAgeForLostBlob=300;this.shape=new app.shapes.Rectangle(0,0,50,35,"#00FFFF","img/source.gif");this.timeToLostMolecule=Number((this.maxAge/this.nbBlob).toFixed(0))};d(a,app.entities.Entity);a.prototype.draw=function(e,c){if(this.age<this.firstAgeForLostBlob){var b=Math.PI*this.degreeBlob/180,d=Number(Math.cos(b).toFixed(2)),b=Number(Math.sin(b).toFixed(2)),
g=this.shape.x+this.shape.width/2,h=this.shape.y+this.shape.height/2;e.beginPath();e.strokeStyle="#18f9ff";e.moveTo(g,h);e.lineTo(g+100*d,h+100*b);e.lineWidth=2;e.lineCap="round";e.stroke()}a.parent.draw.call(this,e,c)};a.prototype.update=function(e){if(this.isBirthday()&&0<this.nbBlob){this.nbBlob--;var b=new app.entities.Blob(30,30,this.degreeBlob);b.shape.x=this.shape.x+this.shape.width/2;b.shape.y=this.shape.y+this.shape.height/2;e.blobEntities.push(b)}else this.age<this.firstAgeForLostBlob&&
0==this.age%100?(b=document.getElementById("startBlob"),b.style.display="block",b.style.margin=this.shape.y+"px "+this.shape.x+"px",b.innerHTML=this.firstAgeForLostBlob/100-this.age/100):this.age>=this.firstAgeForLostBlob&&(b=document.getElementById("startBlob"),b.style.display="none",e.staticBuffering=!1);a.parent.update.call(this,e)};a.prototype.isBirthday=function(){return this.age>=this.firstAgeForLostBlob&&0==this.age%this.lostTime};b.Source=a})();
(function(){var d=app.js.inherit,b=app.entities,a=function(){a.parent.constructor.apply(this);this.className="Wall";this.shape=new app.shapes.Rectangle(0,0,50,50,"#A0CD6C",null,"img/wall.gif")};d(a,app.entities.Entity);b.Wall=a})();
(function(){var d=app.js.inherit,b=app.entities,a=function(){a.parent.constructor.apply(this);this.className="Well";this.nbBlobMax=5;this.nbBlob=0;this.last=!1;this.shape=new app.shapes.Rectangle(0,0,50,52,"#FF0000","img/well.gif");this.attraction=new app.shapes.Ellipse;this.attraction.color="rgba(1,2,3,1)";this.attracted=0;this.factorAttraction=2};d(a,app.entities.Entity);a.prototype.update=function(e){this.nbBlobMax<=this.nbBlob&&!0!==this.last?this.dead(e):a.parent.update.call(this,e)};a.prototype.draw=
function(e,b){this.attraction.x=this.shape.x+this.shape.width/2;this.attraction.y=this.shape.y+this.shape.height/2;this.attraction.width=this.shape.width*this.factorAttraction;this.attraction.height=this.attraction.width;b.showNoneEntities&&(e.save(),e.shadowColor=this.shape.color,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=6,this.attraction.draw(e),e.restore());a.parent.draw.call(this,e,b)};b.Well=a})();
(function(){var d=app.js.inherit,b=app.entities,a=function(){a.parent.constructor.apply(this);this.shape=new app.shapes.Rectangle(0,0,50,52,"#FFCC00","img/magnet.gif");this.factorAttraction=3};d(a,app.entities.Well);b.Magnet=a})();
(function(){var d=app.js.inherit,b=app.entities,a=function(){a.parent.constructor.apply(this);this.shape=new app.shapes.Rectangle(0,0,50,52,"#FFCC00","img/rotate.gif");this.orbit=new app.shapes.Ellipse;this.orbit.color="rgba(0,0,0,1)";this.attracted=0;this.className="Rotate"};d(a,app.entities.Entity);a.prototype.draw=function(e,b){this.orbit.x=this.shape.x+this.shape.width/2;this.orbit.y=this.shape.y+this.shape.height/2;this.orbit.width=Math.max(this.shape.width,this.shape.height)+80;this.orbit.height=
this.orbit.width;b.showNoneEntities&&(e.save(),e.shadowColor=this.shape.color,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=6,this.orbit.draw(e),e.restore());a.parent.draw.call(this,e,b)};b.Rotate=a})();
(function(){var d=app,b=function(){this.showNoneEntities=!0;this.menuRotate={};this.menuMagnet={};this.staticEntities=[];this.blobEntities=[];this.noneEntities=[];this.menuEntities=[];this.startSource=new app.entities.Source;this.endWell=new app.entities.Well;this.endWell.last=!0;this.endWell.shape.color="#80FF02";this.endWell.shape.urlImage="img/wellFinal.gif";this.staticEntities.push(this.startSource);this.staticEntities.push(this.endWell);this.nbBlobDead=0;this.staticBuffering=!1;this.deadlyEntities=
[];this.attractiveEntities=[];this.orbitalEntities=[]};b.prototype.buffering=function(){app.js.isDefined(this.canvasBuffer)?this.canvasBuffer.width=this.canvasBuffer.width:(this.canvasBuffer=document.createElement("canvas"),this.canvasBuffer.width=1024,this.canvasBuffer.height=600);for(var a=this.canvasBuffer.getContext("2d"),e=this.staticEntities.length,b,d=0;d<e;d++)b=this.staticEntities[d],app.js.isDefined(b)&&b.draw(a,this);this.staticBuffering=!0};b.prototype.draw=function(a,b){!1===this.staticBuffering&&
this.buffering();a.drawImage(this.canvasBuffer,0,0);if(!0===b)for(var c=this.staticEntities.length,d,f=0;f<c;f++)d=this.staticEntities[f],app.js.isDefined(d)&&d.update(this);c=this.menuEntities.length;for(f=0;f<c;f++)d=this.menuEntities[f],app.js.isDefined(d)&&d.draw(a,this);if(this.showNoneEntities){c=this.noneEntities.length;for(f=0;f<c;f++)d=this.noneEntities[f],app.js.isDefined(d)&&(!0===b&&d.update(this),d.draw(a,this))}c=this.blobEntities.length;for(f=0;f<c;f++)d=this.blobEntities[f],app.js.isDefined(d)&&
(!0===b&&d.update(a,this),d.draw(a,this))};b.prototype.addEntity=function(a){this.staticBuffering=a.draggable=!1;this.staticEntities.push(a);this.clearIterators()};b.prototype.clearIterators=function(){this.deadlyEntities=[];this.attractiveEntities=[];this.orbitalEntities=[]};b.prototype.getDeadlyEntities=function(){if(0<this.deadlyEntities.length)return this.deadlyEntities;for(var a=0;a<this.staticEntities.length;a++)"Wall"===this.staticEntities[a].className&&this.deadlyEntities.push(this.staticEntities[a]);
return this.deadlyEntities};b.prototype.getAttractiveEntities=function(){if(0<this.attractiveEntities.length)return this.attractiveEntities;for(var a=0;a<this.staticEntities.length;a++)this.staticEntities[a].hasOwnProperty("attraction")&&this.attractiveEntities.push(this.staticEntities[a]);return this.attractiveEntities};b.prototype.getOrbitalEntities=function(){if(0<this.orbitalEntities.length)return this.orbitalEntities;for(var a=0;a<this.staticEntities.length;a++)this.staticEntities[a].hasOwnProperty("orbit")&&
this.orbitalEntities.push(this.staticEntities[a]);return this.orbitalEntities};b.prototype.isFinish=function(){return 0==this.startSource.nbBlob&&0==this.blobEntities.length};b.prototype.isWin=function(){return 0<this.endWell.nbBlob};d.Map=b})();
(function(){var d=app,b=function(a,b){this.endOfGameDiv=document.getElementById("endOfGame");this.listSerializedMap=a;this.canvas=b;this.context=b.getContext("2d");this.restart()};b.prototype.restart=function(){this.loop={};this.score=this.currentIndexMap=0};b.prototype.init=function(){this.currentMap=app.js.deserialize(this.listSerializedMap[this.currentIndexMap],new app.Map);this.menu.init(this.currentMap)};b.prototype.clear=function(){this.context.canvas.width=this.context.canvas.width};b.prototype.start=
function(){var a=this;a.currentMap.isFinish()?a.end():(window.requestAnimFrame(function(){a.isRun&&a.start()}),this.clear(),this.currentMap.draw(this.context,!0),this.isRun=!0)};b.prototype.pause=function(){this.isRun=!1};b.prototype.end=function(){this.pause();var a="<br /> <br />You won by saving  "+this.currentMap.endWell.nbBlob+" Blobs. <br />";this.currentMap.isWin()&&this.currentIndexMap+1<this.listSerializedMap.length?(this.calculScore(),this.createPopup("Congrats ! You won this level !! "+
a+"In this level your score is :"+this.scoreLastMap+" points. <br /> <br />Let's see how you will deal with the next level !<br /> <div style='float:right'><div id='replayLevel'>Replay level</div><div id='nextLevel'>Next level</div><div id='tweetScore'><a href='"+this.createTweetUrl(!1,this.currentIndexMap,this.scoreLastMap,this.currentMap.endWell.nbBlob)+"' target='_blank'>Tweet my score</a></div></div>")):this.currentMap.isWin()?this.createPopup("Congrats ! You won the Blob Rising game !! "+a+"Your final score is : "+
this.scoreLastMap+" points. <br /> <br /><div style='float:right'><div id='replayLevel'>Replay level</div><div id='replayGame'>Replay game</div><div id='tweetScore'><a href='"+this.createTweetUrl(!0,this.currentIndexMap,this.scoreLastMap,this.currentMap.endWell.nbBlob)+"' target='_blank'>Tweet my score</a></div></div>"):(this.score-=100,this.createPopup("Unfortunately you lost this level... <br /> <br />In this level your score is :"+this.score+" points. <br /> <br /> <br />Try again to save Blobs ! <br /><div style='float:right'><div id='replayLevel'>Replay level</div><div id='tweetScore'><a href='"+
this.createTweetUrl(!1,this.currentIndexMap,this.score,this.currentMap.endWell.nbBlob)+"' target='_blank'>Tweet my score</a></div></div>"));document.getElementById("score").innerHTML="Score : "+this.score+" Blob"};b.prototype.createTweetUrl=function(a,b,c,d){c=" with "+c+" points. I saved "+d+" Blobs. Try it yourself !&url=http://blobrising.github.com/BlobRising/&via=BlobRising&related=BlobRising";return a?encodeURI("https://twitter.com/intent/tweet?text=I played Blob Rising and I won the game"+c):
encodeURI("https://twitter.com/intent/tweet?text=I played Blob Rising, I have done the level "+(b+1)+c)};b.prototype.onNextLevelClick=function(){this.currentIndexMap+=1;this.createStartGame()};b.prototype.onReplayLevelClick=function(){this.createStartGame()};b.prototype.onReplayGameClick=function(){this.endOfGameDiv.style.display="none";this.pause();this.menu.showHelp();this.restart();this.init();this.menu.showMapName();document.getElementById("score").innerHTML="Score : "+this.score+" Blob"};b.prototype.createStartGame=
function(){this.endOfGameDiv.style.display="none";var a=this.currentMap.showNoneEntities;this.clear();this.init();this.currentMap.showNoneEntities=a;this.start();this.menu.showMapName()};b.prototype.createPopup=function(a){var b=this;this.endOfGameDiv.innerHTML=a;this.endOfGameDiv.style.display="block";this.endOfGameNextLevel=document.getElementById("nextLevel");app.js.isDefined(this.endOfGameNextLevel)&&(this.endOfGameNextLevel.style.display="inline-block",this.endOfGameNextLevel.addEventListener("mousedown",
function(a){app.Game.prototype.onNextLevelClick.call(b,a)},!1));this.endOfGameReplayGame=document.getElementById("replayGame");app.js.isDefined(this.endOfGameReplayGame)&&(this.endOfGameReplayGame.style.display="inline-block",this.endOfGameReplayGame.addEventListener("mousedown",function(a){app.Game.prototype.onReplayGameClick.call(b,a)},!1));this.endOfGameTweetScore=document.getElementById("tweetScore");app.js.isDefined(this.endOfGameTweetScore)&&(this.endOfGameTweetScore.style.display="inline-block",
this.endOfGameTweetScore.addEventListener("mousedown",function(a){app.Game.prototype.onTweetScoreClick.call(b,a)},!1));this.endOfGameReplayLevel=document.getElementById("replayLevel");app.js.isDefined(this.endOfGameTweetScore)&&(this.endOfGameReplayLevel.style.display="inline-block",this.endOfGameReplayLevel.addEventListener("mousedown",function(a){app.Game.prototype.onReplayLevelClick.call(b,a)},!1))};b.prototype.calculScore=function(){for(var a=0,b=this.currentMap.staticEntities.length,c=0;c<b;c++)!0===
this.currentMap.staticEntities[c].isFromMenu&&a++;this.scoreLastMap=100*this.currentMap.endWell.nbBlob+100*(this.currentMap.menuRotate.nb+this.currentMap.menuMagnet.nb-a)-100*(this.currentMap.nbBlobDead-this.currentMap.endWell.nbBlob);this.score+=this.scoreLastMap};d.Game=b})();
(function(){var d=app,b=function(a){this.game=a;this.isFirstAddWell=!0;this.scoreDiv=document.getElementById("score");this.helpDiv=document.getElementById("mainMenu");this.endOfGameDiv=document.getElementById("endOfGame");this.startBlobDiv=document.getElementById("startBlob");this.endOfGameDiv.style.display="none";this.firstInnerHTML=this.helpDiv.innerHTML;this.firstDisplay=this.helpDiv.style.display;var b=this;this.game.canvas.addEventListener("mousemove",function(a){app.Menu.prototype.onCanvasMove.call(b,
a)},!1);this.game.canvas.addEventListener("mousedown",function(a){app.Menu.prototype.onCanvasClick.call(b,a)},!1);document.onkeypress=function(c){c=c||window.event;if(c="number"==typeof c.which?c.which:c.keyCode)if(32==c)a.isRun&&!a.currentMap.isFinish()?(a.pause(),b.showHelp()):a.currentMap.isFinish()||(a.start(),b.showMapName());else if(114==c)a.pause(),b.showHelp(),a.restart(),a.init();else if(38==c)a.currentIndexMap++,a.init();else if(108==c)a.clear(),a.init(),a.start(),b.showMapName(),b.showHelp("This level has been restarted",
"1000");else if(a.isRun)if(115==c)a.currentMap.showNoneEntities=!a.currentMap.showNoneEntities,a.currentMap.showNoneEntities||(a.currentMap.noneEntities=[]),a.currentMap.staticBuffering=!1,a.clear(),a.currentMap.draw(a.context,!1);else if(120==c||99==c)!0===b.isFirstAddWell&&(b.isFirstAddWell=!1,b.showHelp("Move your mouse and then click to add well !","mousedown")),120==c?0<b.nbRotate?b.addEntity(a,app.js.clone(a.currentMap.menuRotate)):b.showHelp("You have no more rotate machine !","1000"):0<b.nbMagnet?
b.addEntity(a,app.js.clone(a.currentMap.menuMagnet)):b.showHelp("You have no more magnet machine !","1000")}};b.prototype.init=function(a){this.nbRotateInit=this.nbRotate=a.menuRotate.nb;this.nbMagnetInit=this.nbMagnet=a.menuMagnet.nb;this.updateMenuEntities()};b.prototype.showMapName=function(){this.showHelp("You are on <div class='keyboard'>"+this.game.currentMap.mapName+"</div> map",3E3)};b.prototype.addEntity=function(a,b){null!=this.entitySelected&&this.entitySelected.hasPosed?this.showHelp("You must put your machine before add another !",
"1000"):(b.shape.x=-1E3,b.shape.y=-1E3,b.draw(a.context,a.currentMap),b.isFromMenu=!0,b.isDraggable=!0,this.entitySelected=b,b.draggable=!0,b.hasPosed=!1,a.currentMap.menuEntities=[],a.currentMap.menuEntities.push(b))};b.prototype.showHelp=function(a,b){this.helpDiv.style.display="block";this.lastStartBlobDiv=this.startBlobDiv.style.display;if(!app.js.isDefined(a)&&!app.js.isDefined(b))this.startBlobDiv.style.display="none",this.helpDiv.className="mainMenu",this.scoreDiv.style.display="block",this.helpDiv.innerHTML=
this.firstInnerHTML;else if(this.helpDiv.className="helpInGame","mousedown"===b){this.helpDiv.innerHTML=a;var c=this;this.game.canvas.addEventListener("mousedown",function(){c.hideHelp()},!1)}else clearTimeout(this.timeout),this.helpDiv.innerHTML=a,c=this,this.timeout=setTimeout(function(){c.hideHelp()},b)};b.prototype.hideHelp=function(){this.game.isRun?(this.startBlobDiv.style.display=this.lastStartBlobDiv,this.helpDiv.style.display="none",this.scoreDiv.style.display="none"):this.game.currentMap.isFinish()||
this.showHelp()};b.prototype.updateMenuEntities=function(){document.getElementById("nbMenuRotate").innerHTML=this.nbRotate+"/"+this.nbRotateInit;document.getElementById("nbMenuMagnet").innerHTML=this.nbMagnet+"/"+this.nbMagnetInit};b.prototype.onCanvasMove=function(a){var b=this.game.canvas,c=a.clientX-document.documentElement.scrollLeft-b.offsetLeft,a=a.clientY-document.documentElement.scrollTop-b.offsetTop;app.js.isDefined(this.entitySelected)&&this.entitySelected.imAlive&&(this.setEntityPosition(c,
a),this.game.clear(),this.game.currentMap.draw(this.game.context,!1),this.entitySelected.shape.draw(this.game.context))};b.prototype.onCanvasClick=function(a){var b=this.game.canvas,c=a.clientX-document.documentElement.scrollLeft-b.offsetLeft,a=a.clientY-document.documentElement.scrollTop-b.offsetTop;if(app.js.isDefined(this.entitySelected))app.js.isDefined(this.entitySelected)&&("Rotate"==this.entitySelected.className&&!1===this.entitySelected.hasPosed?this.nbRotate--:!1===this.entitySelected.hasPosed&&
this.nbMagnet--,this.entitySelected.hasPosed=!0,this.updateMenuEntities(),this.setEntityPosition(c,a),this.entitySelected.draggable=!1,app.js.arrayRemove(this.game.currentMap.menuEntities,this.entitySelected),this.game.currentMap.addEntity(this.entitySelected),this.game.clear(),this.game.currentMap.draw(this.game.context,!1),this.entitySelected=null);else for(var b=this.game.currentMap.staticEntities.length,d=!1,f=0;f<b&&!d;f++){var g=this.game.currentMap.staticEntities[f];this.isClick(g,c,a)&&(d=
!0,this.entitySelected=g,app.js.arrayRemove(this.game.currentMap.staticEntities,this.entitySelected),this.game.currentMap.staticBuffering=!1,this.game.currentMap.menuEntities.push(this.entitySelected),this.game.currentMap.clearIterators())}};b.prototype.setEntityPosition=function(a,b){this.entitySelected.shape.x=a-this.entitySelected.shape.width/2;this.entitySelected.shape.y=b-this.entitySelected.shape.width/2};b.prototype.isClick=function(a,b,c){if(!0===a.isFromMenu&&!0===a.isDraggable){var d=a.shape.x,
f=a.shape.y,g=a.shape.height;if(!(d+a.shape.width<b||d>b+1||f+g<c||f>c+1))return!0}return!1};d.Menu=b})();(function(){window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,50)};var d=document.getElementById("canvas"),b=new app.Game(maps,d);d.width=1024;d.height=600;document.body.appendChild(d);d=new app.Menu(b);b.menu=d;b.init()})();
