// Input 0
(function(){this.app=this.app||{}}).apply(window);var Sylvester={precision:0.001,Vector:function(){},Matrix:function(){}};Sylvester.Matrix.create=function(d){return(new Sylvester.Matrix).setElements(d)};var $M=Sylvester.Matrix.create;
Sylvester.Matrix.Rotation=function(d,c){if(!c)return Sylvester.Matrix.create([[Math.cos(d),-Math.sin(d)],[Math.sin(d),Math.cos(d)]]);var a=c.dup();if(3!==a.elements.length)return null;var b=a.modulus(),e=a.elements[0]/b,h=a.elements[1]/b,a=a.elements[2]/b,b=Math.sin(d),g=Math.cos(d),f=1-g;return Sylvester.Matrix.create([[f*e*e+g,f*e*h-b*a,f*e*a+b*h],[f*e*h+b*a,f*h*h+g,f*h*a-b*e],[f*e*a-b*h,f*h*a+b*e,f*a*a+g]])};
Sylvester.Matrix.prototype={dup:function(){return Sylvester.Matrix.create(this.elements)},setElements:function(d){var c,a=d.elements||d;if(a[0]&&"undefined"!==typeof a[0][0]){d=a.length;for(this.elements=[];d--;){c=a[d].length;for(this.elements[d]=[];c--;)this.elements[d][c]=a[d][c]}return this}c=a.length;this.elements=[];for(d=0;d<c;d++)this.elements.push([a[d]]);return this}};Sylvester.Vector.create=function(d){return(new Sylvester.Vector).setElements(d)};var $V=Sylvester.Vector.create;
Sylvester.Vector.prototype={forEach:function(d,c){for(var a=this.elements.length,b=0;b<a;b++)d.call(c,this.elements[b],b+1)},angleFrom:function(d){var c=d.elements||d;if(this.elements.length!==c.length)return null;var a=0,b=0,e=0;this.each(function(h,d){a+=h*c[d-1];b+=h*h;e+=c[d-1]*c[d-1]});b=Math.sqrt(b);e=Math.sqrt(e);if(0===b*e)return null;d=a/(b*e);-1>d&&(d=-1);1<d&&(d=1);return Math.acos(d)},rotate:function(d,c){var a,b=null,e,h;d.determinant&&(b=d.elements);switch(this.elements.length){case 2:a=
c.elements||c;if(2!==a.length)return null;b||(b=Sylvester.Matrix.Rotation(d).elements);e=this.elements[0]-a[0];h=this.elements[1]-a[1];return Sylvester.Vector.create([a[0]+b[0][0]*e+b[0][1]*h,a[1]+b[1][0]*e+b[1][1]*h]);case 3:if(!c.direction)return null;var g=c.pointClosestTo(this).elements;b||(b=Sylvester.Matrix.Rotation(d,c.direction).elements);e=this.elements[0]-g[0];h=this.elements[1]-g[1];a=this.elements[2]-g[2];return Sylvester.Vector.create([g[0]+b[0][0]*e+b[0][1]*h+b[0][2]*a,g[1]+b[1][0]*
e+b[1][1]*h+b[1][2]*a,g[2]+b[2][0]*e+b[2][1]*h+b[2][2]*a]);default:return null}},setElements:function(d){this.elements=(d.elements||d).slice();return this}};Sylvester.Vector.prototype.x=Sylvester.Vector.prototype.multiply;Sylvester.Vector.prototype.each=Sylvester.Vector.prototype.forEach;var logLevel=1,devName="m@n",className="";console.log("Logs start for "+devName+" with "+logLevel+" level");
var maps=[{initSize:{width:1301,height:411},menuRotate:{className:"Rotate",nb:4},menuMagnet:{className:"Magnet",nb:4},menuEntities:[{className:"Well",nb:5,nbBlobMax:10}],staticEntities:[{className:"Wall",shape:{x:200,y:10,width:35,height:300}},{className:"Wall",shape:{x:200,y:10,width:35,height:300}},{className:"Wall",shape:{x:310,y:280,width:200,height:35}},{className:"Wall",shape:{x:650,y:280,width:260,height:35}},{className:"Wall",shape:{x:570,y:10,width:35,height:230}},{className:"Well",shape:{x:400,
y:70}},{className:"Well",shape:{x:800,y:450}}],startSource:{degreeBlob:55,shape:{x:50,y:50}},endWell:{shape:{x:800,y:100}}},{initSize:{width:1301,height:656},menuRotate:{className:"Rotate",nb:10},menuMagnet:{className:"Magnet",nb:10},staticEntities:[{className:"Magnet",shape:{x:450,y:313}},{className:"Well",shape:{x:560,y:450}},{className:"Wall",shape:{x:743,y:500,width:35,height:100}}],startSource:{degreeBlob:345,shape:{x:300,y:150}},endWell:{shape:{x:736,y:128}}},{initSize:{width:1301,height:656},
menuRotate:{className:"Rotate",nb:5},menuMagnet:{className:"Magnet",nb:5},staticEntities:[{className:"Well",shape:{x:300,y:200}},{className:"Wall",shape:{x:550,y:200,height:180}}],startSource:{degreeBlob:40,shape:{x:50,y:100}},endWell:{shape:{x:500,y:250}}},{initSize:{width:1301,height:411},menuRotate:{className:"Rotate",nb:5},menuMagnet:{className:"Magnet",nb:5},menuEntities:[{className:"Well",nb:5,nbBlobMax:10}],staticEntities:[{className:"Well",shape:{x:200,y:200}}],startSource:{degreeBlob:60,
shape:{x:50,y:100}},endWell:{shape:{x:500,y:100}}}];
(function(){app.js={};app.js.isDefined=function(c){return"undefined"!==typeof c&&null!==c};var d={}.hasOwnProperty;app.js.inherit=function(c,a){function b(){this.constructor=c}for(var e in a)d.call(a,e)&&(c[e]=a[e]);b.prototype=a.prototype;c.prototype=new b;c.parent=a.prototype;return c};app.js.stringToClass=function(c){for(var c=c.split("."),a=window||this,b=0,e=c.length;b<e;b++)a=a[c[b]];if("function"!==typeof a)throw Error("function not found");return a};app.js.deserialize=function(c,a){var b=
{};app.js.isDefined(c)&&app.js.isDefined(c.className)?b=new (app.js.stringToClass("app.entities."+c.className)):app.js.isDefined(a)&&(b=a);for(var e in c)if(c[e]instanceof Array){app.js.isDefined(b[e])||(b[e]=[]);for(var h in c[e])b[e].push(app.js.deserialize(c[e][h]))}else b[e]="object"==typeof c[e]?app.js.deserialize(c[e],b[e]):c[e];return b};app.js.clone=function(c){return app.js.deserialize(c)};app.js.arrayRemove=function(c,a){if(!app.js.isDefined(c)||!app.js.isDefined(a))console.trace();else{var b=
c.indexOf(a);-1!=b&&c.splice(b,1);return-1!=b}};app.js.getObjectClass=function(c){if(c&&c.constructor&&c.constructor.toString&&(c=c.constructor.toString().match(/function\s*(\w+)/))&&2==c.length)return c[1]};app.js.log=function(c,a,b,e,h){c==logLevel&&-1<a.indexOf(devName)&&(""==className?console.log(b):app.js.isDefined(e)&&app.js.getObjectClass(e)==className&&console.log(b),app.js.isDefined(h)&&!0===h&&console.trace())}})();
(function(){app.shapes=app.shapes||{};var d=app.shapes,c=function(a,b,e,c,d,f,j,i){this.x=a;this.y=b;this.width=e;this.height=c;this.color=d;this.urlImage=f;this.urlPattern=j;this.urlSprite=i};c.prototype.drawImage=function(a,b){var e=new Image;if(app.js.isDefined(this.urlSprite)){e.src=this.urlSprite;var c=0,d=180*b.radian/Math.PI;0<d&&45>=d?c=132:45<d&&90>=d?c=154:90<d&&135>=d?c=0:135<d&&180>=d?c=22:180<d&&225>=d?c=44:225<d&&270>=d?c=66:270<d&&315>=d?c=88:315<d&&360>=d&&(c=110);a.drawImage(e,0,
c,20,20,this.x,this.y,this.width,this.height)}else e.src=this.urlImage,a.drawImage(e,this.x,this.y,this.width,this.height)};d.Shape=c})();
(function(){var d=app.js.inherit,c=app.shapes,a=function(){a.parent.constructor.apply(this,arguments)};d(a,app.shapes.Shape);a.prototype.draw=function(b,e){b.save();if(app.js.isDefined(this.urlImage)||app.js.isDefined(this.urlSprite))a.parent.drawImage.call(this,b,e);else if(app.js.isDefined(this.urlPattern)){var c=new Image;c.src=this.urlPattern;c=b.createPattern(c,"repeat");b.fillStyle=this.color;b.fillRect(this.x,this.y,this.width,this.height);b.fillStyle=c;b.fillRect(this.x,this.y,this.width,
this.height);b.strokeStyle="#626163";b.strokeRect(this.x,this.y,this.width,this.height)}b.restore()};c.Rectangle=a})();
(function(){var d=app.js.inherit,c=app.shapes,a=function(b,e,c,d,f,j){a.parent.constructor.apply(this,arguments)};d(a,app.shapes.Shape);a.prototype.draw=function(b){b.beginPath();b.arc(this.x,this.y,this.width/2,0,2*Math.PI,!1);b.closePath();app.js.isDefined(this.urlImage)&&a.parent.drawImage.call(this,b);b.strokeStyle=this.color;b.stroke()};a.prototype.getRadius=function(){return this.width/2};c.Ellipse=a})();
(function(){app.physics={};var d=app.js.isDefined,c=app.physics,a=function(b,a,c){this.entity=b;this.speed=a;this.radian=Math.PI*c/180;b=Number(Math.cos(this.radian).toFixed(2));a=Number(Math.sin(this.radian).toFixed(2));this.angle=$V([b,a])};a.prototype.update=function(b,a,c){var d=this.entity.shape.x,f=this.entity.shape.y,j=this.entity.shape.height,i=this.entity.shape.width,k=f+this.speed*this.angle.elements[1],l=Number((d+this.speed*this.angle.elements[0]).toFixed(2)),k=Number(k.toFixed(2));this.setCoordinate(l,
k);0>=f?this.entity.dead(b):0>=d?this.entity.dead(b):0>=f||f>=c-j?this.entity.dead(b):d>=a-i&&this.entity.dead(b)};a.prototype.setCoordinate=function(b,a){this.entity.shape.x=b;this.entity.shape.y=a};a.prototype.attractTo=function(b){this.angle=this.calculAngle(this.entity.shape,b)};a.prototype.calculAngle=function(b,a){var c=Math.atan2(a.y-b.y,a.x-b.x)/(Math.PI/180);this.radian=Math.PI*c/180;var c=Math.cos(this.radian),d=Math.sin(this.radian);return $V([c,d])};a.prototype.rotateAround=function(b){var a=
this.entity.shape.x,c=this.entity.shape.y,d=$V([b.x,b.y]);relativX=b.x-a;relativY=b.y-c;this.radian=$V([relativX,relativY]).angleFrom(d);var b=Number(Math.cos(this.radian+Math.PI/2).toFixed(2)),f=Number(Math.sin(this.radian+Math.PI/2).toFixed(2));this.angle=$V([b,f]);b=this.speed*Math.PI/180;a=$V([a,c]).rotate(b,d);this.setCoordinate(a.elements[0],a.elements[1]);this.speed+=0.01};a.prototype.distanceWith=function(b,a){var c=this.entity.shape.y;return Math.sqrt(Math.pow(this.entity.shape.x-b,2)+Math.pow(c-
a,2))};a.prototype.isInRectangle=function(b,a){var c=b.shape.x,d=b.shape.y,f=b.shape.height,j=b.shape.width,i=a.shape.x,k=a.shape.y,l=a.shape.height;return i+a.shape.width<c||i>c+j||k+l<d||k>d+f?!1:!0};a.prototype.isInRadius=function(b){var a=b.getRadius();if(!d(a)||0>=a)return!1;var c=this.entity.shape.y+this.entity.shape.height/2,g=this.entity.shape.width,f=this.entity.shape.height,j=Math.abs(b.x-(this.entity.shape.x+this.entity.shape.width/2)),b=Math.abs(b.y-c);if(j>g/2+a||b>f/2+a)return!1;if(j<=
g/2||b<=f/2)return!0;cornerDistance=Math.pow(j-g/2,2)+Math.pow(b-f/2,2);return cornerDistance<=Math.pow(a,2)};c.Physic=a})();
(function(){app.entities=app.entities||{};var d=app.entities,c=function(){this.age=0;this.imAlive=!0;this.shape=new app.shapes.Rectangle;this.draggable=!1};c.prototype.update=function(a,b){this.incrementMyAge(b)};c.prototype.draw=function(a){this.shape.draw(a)};c.prototype.incrementMyAge=function(){this.age++};c.prototype.dead=function(a){this.imAlive=!1;app.js.arrayRemove(a.staticEntities,this)};d.Entity=c})();
(function(){var d=app.js.inherit,c=app.entities,a=function(b,c){a.parent.constructor.apply(this);this.maxAge=100;this.shape=new app.shapes.Rectangle(0,0,b,c,"#FF0000",null,null,"img/blobSprite.gif");this.initialWidth=b;this.initialHeight=c};d(a,app.entities.Entity);a.prototype.draw=function(b){this.shape.draw(b,this.physic)};a.prototype.incrementMyAge=function(b){a.parent.incrementMyAge.call(this,b);this.age<this.maxAge&&0<this.shape.width?(this.shape.width=this.initialWidth-this.initialWidth/this.maxAge*
this.age,this.shape.height=this.initialHeight-this.initialHeight/this.maxAge*this.age):this.dead(b)};a.prototype.dead=function(b){this.imAlive=!1;app.js.arrayRemove(b.noneEntities,this)};c.Molecule=a})();
(function(){var d=app.js.inherit,c=app.entities,a=function(b,c,d){a.parent.constructor.apply(this,arguments);this.nbBlob=50;this.maxAge=1E3;this.physic=new app.physics.Physic(this,2,d);this.shape=new app.shapes.Rectangle(0,0,b,c,"#00FF00",null,null,"img/blobSprite.gif");this.timeToLostMolecule=Number((this.maxAge/this.nbBlob).toFixed(0));this.firstAttract=!0};d(a,app.entities.Molecule);a.prototype.update=function(b,c,d){for(var b=!0,g=!1,f=d.getDeadlyEntities(),j=0;j<f.length;j++){var i=f[j];if(this.physic.isInRectangle(this,
i)&&!1===i.draggable){this.dead(d);b=!1;g=!0;break}}if(!g){f=d.getAttractiveEntities();for(j=0;j<f.length;j++)if(i=f[j],this.physic.isInRadius(i.attraction)&&!1===i.draggable){if("Well"==app.js.getObjectClass(i)){this.dead(d);i.nbBlob++;return}8>i.attracted&&(this.firstAttract||(this.physic.angle=$V([this.oldAngle.x,this.oldAngle.y])),this.physic.attractTo(i.attraction),this.firstAttract=!1,i.attracted++,g=!0,this.attractedBy=i,this.oldAngle={x:this.physic.angle.elements[0],y:this.physic.angle.elements[1]})}else i.attracted=
0}if(!g){g=d.getOrbitalEntities();for(j=0;j<g.length;j++)i=g[j],this.physic.isInRadius(i.orbit)&&!1===i.draggable&&(this.physic.rotateAround(i.orbit),b=!1)}b&&this.physic.update(d,c.canvas.width,c.canvas.height);this.isBirthday()&&0<this.nbBlob&&(this.nbBlob--,d.showNoneEntities&&(c=new app.entities.Molecule(this.shape.width,this.shape.height),c.shape.x=this.shape.x,c.shape.y=this.shape.y,c.physic={radian:this.physic.radian},d.noneEntities.push(c)));a.parent.incrementMyAge.call(this,d)};a.prototype.isBirthday=
function(){return 0==this.age%this.timeToLostMolecule&&this.imAlive};a.prototype.dead=function(b){this.imAlive=!1;b.nbBlobDead++;app.js.arrayRemove(b.blobEntities,this)};c.Blob=a})();
(function(){var d=app.js.inherit,c=app.entities,a=function(){a.parent.constructor.apply(this);this.nbBlob=1;this.maxAge=this.lostTime=100;this.degreeBlob=120;this.firstAgeForLostBlob=300;this.shape=new app.shapes.Rectangle(0,0,50,35,"#00FFFF","img/source.gif");this.timeToLostMolecule=Number((this.maxAge/this.nbBlob).toFixed(0))};d(a,app.entities.Entity);a.prototype.update=function(b,c){if(this.isBirthday()&&0<this.nbBlob){this.nbBlob--;var d=new app.entities.Blob(30,30,this.degreeBlob);d.shape.x=
this.shape.x+this.shape.width/2;d.shape.y=this.shape.y+this.shape.height/2;c.blobEntities.push(d)}else this.age<this.firstAgeForLostBlob&&0==this.age%100?(d=document.getElementById("startBlob"),d.style.display="block",d.style.margin=this.shape.y+"px "+this.shape.x+"px",d.innerHTML=this.firstAgeForLostBlob/100-this.age/100):this.age>=this.firstAgeForLostBlob&&(d=document.getElementById("startBlob"),d.style.display="none");a.parent.update.call(this,b,c)};a.prototype.isBirthday=function(){return this.age>=
this.firstAgeForLostBlob&&0==this.age%this.lostTime};c.Source=a})();(function(){var d=app.js.inherit,c=app.entities,a=function(){a.parent.constructor.apply(this);this.shape=new app.shapes.Rectangle(0,0,50,50,"#A0CD6C",null,"img/wall_pattern.gif")};d(a,app.entities.Entity);a.prototype.update=function(b,c){a.parent.update.call(this,b,c)};c.Wall=a})();
(function(){var d=app.js.inherit,c=app.entities,a=function(){a.parent.constructor.apply(this);this.nbBlobMax=5;this.nbBlob=0;this.last=!1;this.shape=new app.shapes.Rectangle(0,0,50,52,"#FF0000","img/well.gif");this.attraction=new app.shapes.Ellipse;this.attraction.color="rgba(1,2,3,1)";this.attracted=0};d(a,app.entities.Entity);a.prototype.update=function(b,c){this.nbBlobMax<=this.nbBlob&&!0!==this.last?this.dead(c):a.parent.update.call(this,b,c)};a.prototype.draw=function(b,c){c.showNoneEntities&&
(this.attraction.x=this.shape.x+this.shape.width/2,this.attraction.y=this.shape.y+this.shape.height/2,this.attraction.width=2*this.shape.width,this.attraction.height=2*this.shape.width,b.save(),b.shadowColor=this.shape.color,b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=6,this.attraction.draw(b),b.restore());a.parent.draw.call(this,b,c)};c.Well=a})();
(function(){var d=app.js.inherit,c=app.entities,a=function(){a.parent.constructor.apply(this);this.nbBlobMax=5;this.nbBlob=0;this.last=!1;this.shape=new app.shapes.Rectangle(0,0,50,52,"#FFCC00","img/magnet.gif");this.attraction=new app.shapes.Ellipse;this.attraction.color="rgba(1,2,3,1)";this.attracted=0};d(a,app.entities.Entity);a.prototype.update=function(b,c){this.nbBlobMax<=this.nbBlob&&!0!==this.last?this.dead(c):a.parent.update.call(this,b,c)};a.prototype.draw=function(b,c){c.showNoneEntities&&
(this.attraction.x=this.shape.x+this.shape.width/2,this.attraction.y=this.shape.y+this.shape.height/2,this.attraction.width=3*this.shape.width,this.attraction.height=this.attraction.width,b.save(),b.shadowColor=this.shape.color,b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=6,this.attraction.draw(b),b.restore());a.parent.draw.call(this,b,c)};c.Magnet=a})();
(function(){var d=app.js.inherit,c=app.entities,a=function(){a.parent.constructor.apply(this);this.nbBlobMax=5;this.nbBlob=0;this.last=!1;this.shape=new app.shapes.Rectangle(0,0,50,52,"#FFCC00","img/rotate.gif");this.orbit=new app.shapes.Ellipse;this.orbit.color="rgba(0,0,0,1)";this.attracted=0};d(a,app.entities.Entity);a.prototype.update=function(b,c){this.nbBlobMax<=this.nbBlob&&!0!==this.last?this.dead(c):a.parent.update.call(this,b,c)};a.prototype.draw=function(b,c){c.showNoneEntities&&(this.orbit.x=
this.shape.x+this.shape.width/2,this.orbit.y=this.shape.y+this.shape.height/2,this.orbit.width=Math.max(this.shape.width,this.shape.height)+80,this.orbit.height=this.orbit.width,b.save(),b.shadowColor=this.shape.color,b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=6,this.orbit.draw(b),b.restore());a.parent.draw.call(this,b,c)};c.Rotate=a})();
(function(){var d=app.js.getObjectClass,c=app,a=function(){this.showNoneEntities=!0;this.menuRotate={};this.menuMagnet={};this.staticEntities=[];this.blobEntities=[];this.noneEntities=[];this.startSource=new app.entities.Source;this.endWell=new app.entities.Well;this.endWell.last=!0;this.endWell.shape.color="#80FF02";this.endWell.shape.urlImage="img/wellFinal.gif";this.staticEntities.push(this.startSource);this.staticEntities.push(this.endWell);this.nbBlobDead=0;this.deadlyEntities=[];this.attractiveEntities=
[];this.orbitalEntities=[]};a.prototype.draw=function(b,a){for(var c=this.staticEntities.length,d,f=0;f<c;f++)d=this.staticEntities[f],app.js.isDefined(d)&&(app.js.isDefined(a)&&!0===a&&d.update($V([1,1]),this),d.draw(b,this));c=this.blobEntities.length;for(f=0;f<c;f++)d=this.blobEntities[f],app.js.isDefined(d)&&(app.js.isDefined(a)&&!0===a&&d.update($V([1,1]),b,this),d.draw(b,this));if(this.showNoneEntities){c=this.noneEntities.length;for(f=0;f<c;f++)d=this.noneEntities[f],app.js.isDefined(d)&&(app.js.isDefined(a)&&
!0===a&&d.update($V([1,1]),this),d.draw(b,this))}};a.prototype.addEntity=function(b){b.draggable=!1;this.staticEntities.push(b);this.clearIterators()};a.prototype.clearIterators=function(){this.deadlyEntities=[];this.attractiveEntities=[];this.orbitalEntities=[]};a.prototype.getDeadlyEntities=function(){if(0<this.deadlyEntities.length)return this.deadlyEntities;for(var b=0;b<this.staticEntities.length;b++)"Wall"===d(this.staticEntities[b])&&this.deadlyEntities.push(this.staticEntities[b]);return this.deadlyEntities};
a.prototype.getAttractiveEntities=function(){if(0<this.attractiveEntities.length)return this.attractiveEntities;for(var b=0;b<this.staticEntities.length;b++)this.staticEntities[b].hasOwnProperty("attraction")&&this.attractiveEntities.push(this.staticEntities[b]);return this.attractiveEntities};a.prototype.getOrbitalEntities=function(){if(0<this.orbitalEntities.length)return this.orbitalEntities;for(var b=0;b<this.staticEntities.length;b++)this.staticEntities[b].hasOwnProperty("orbit")&&this.orbitalEntities.push(this.staticEntities[b]);
return this.orbitalEntities};a.prototype.isFinish=function(){return 0==this.startSource.nbBlob&&0==this.blobEntities.length};a.prototype.isWin=function(){return 0<this.endWell.nbBlob};c.Map=a})();
(function(){var d=app,c=function(a,b){this.listSerializedMap=a;this.canvas=b;this.context=b.getContext("2d");this.restart()};c.prototype.restart=function(){this.loop={};this.score=this.currentIndexMap=0};c.prototype.init=function(){this.currentMap=app.js.deserialize(this.listSerializedMap[this.currentIndexMap],new app.Map);this.menu.init(this.currentMap)};c.prototype.clear=function(){this.context.canvas.width=this.context.canvas.width};c.prototype.start=function(){var a=this;a.currentMap.isFinish()?
a.end():(window.requestAnimFrame(function(){a.isRun&&a.start()}),this.clear(),this.currentMap.draw(this.context,!0),this.isRun=!0)};c.prototype.pause=function(){this.isRun=!1};c.prototype.end=function(){this.pause();if(this.currentMap.isWin()&&this.currentIndexMap+1<this.listSerializedMap.length){this.calculScore();document.getElementById("score").innerHTML="Score : "+this.score+" Blob";window.alert("WITH "+this.currentMap.endWell.nbBlob+" BLOB, YOU WIN LEVEL !!");var a=this.currentMap.showNoneEntities;
this.currentIndexMap+=1;this.init();this.currentMap.showNoneEntities=a;this.clear();this.currentMap.draw(this.context,!1);this.pause();this.menu.showHelp()}else this.currentMap.isWin()?window.alert("YOU WIN GAME !! With "+this.score+" Blob"):(window.alert("YOU LOOSE !!"),this.score--,this.clear(),this.init(),this.start())};c.prototype.calculScore=function(){for(var a=0,b=this.currentMap.staticEntities.length,c=0;c<b;c++)this.currentMap.staticEntities[c].isFromMenu&&a++;this.score+=100*this.currentMap.endWell.nbBlob+
100*(this.currentMap.menuRotate.nb+this.currentMap.menuMagnet.nb-a)-100*this.currentMap.nbBlobDead};d.Game=c})();
(function(){var d=app,c=function(a){this.game=a;this.isFirstAddWell=!0;this.scoreDiv=document.getElementById("score");this.helpDiv=document.getElementById("mainMenu");this.firstInnerHTML=this.helpDiv.innerHTML;this.firstDisplay=this.helpDiv.style.display;var b=this;this.game.canvas.addEventListener("mousemove",function(a){app.Menu.prototype.onCanvasMove.call(b,a)},!1);this.game.canvas.addEventListener("mousedown",function(a){app.Menu.prototype.onCanvasClick.call(b,a)},!1);document.onkeypress=function(c){c=
c||window.event;if(c="number"==typeof c.which?c.which:c.keyCode)if(32==c)a.isRun?(a.pause(),b.showHelp()):(a.start(),b.hideHelp());else if(114==c)a.pause(),b.showHelp(),a.restart(),a.init();else if(a.isRun)if(115==c)a.currentMap.showNoneEntities=!a.currentMap.showNoneEntities,a.currentMap.showNoneEntities||(a.currentMap.noneEntities=[]),a.clear(),a.currentMap.draw(a.context,!1);else if(120==c||99==c)(!0===b.isFirstAddWell&&(b.isFirstAddWell=!1,b.showHelp("Move your mouse and then click to add well !",
"mousedown")),120==c)?0<b.nbRotate?(b.nbRotate--,b.addEntity(a,app.js.clone(a.currentMap.menuRotate))):b.showHelp("You have no more rotate machine !","1000"):0<b.nbMagnet?(b.nbMagnet--,b.addEntity(a,app.js.clone(a.currentMap.menuMagnet))):b.showHelp("You have no more magnet machine !","1000")}};c.prototype.init=function(a){this.nbRotateInit=this.nbRotate=a.menuRotate.nb;this.nbMagnetInit=this.nbMagnet=a.menuMagnet.nb;this.updateMenuEntities()};c.prototype.addEntity=function(a,b){b.shape.x=-1E3;b.shape.y=
-1E3;b.draw(a.context,a.currentMap);b.isFromMenu=!0;this.entitySelected=b;b.draggable=!0;a.currentMap.staticEntities.push(b)};c.prototype.showHelp=function(a,b){this.helpDiv.style.display="block";if(!app.js.isDefined(a)&&!app.js.isDefined(b))this.helpDiv.className="mainMenu",this.scoreDiv.style.display="block",this.helpDiv.innerHTML=this.firstInnerHTML;else if(this.helpDiv.className="helpInGame","mousedown"===b){this.helpDiv.innerHTML=a;var c=this;this.game.canvas.addEventListener("mousedown",function(){c.hideHelp()},
!1)}else clearTimeout(this.timeout),this.helpDiv.innerHTML=a,c=this,this.timeout=setTimeout(function(){c.hideHelp()},b)};c.prototype.hideHelp=function(){this.game.isRun?(this.helpDiv.style.display="none",this.scoreDiv.style.display="none"):this.showHelp()};c.prototype.updateMenuEntities=function(){document.getElementById("nbMenuRotate").innerHTML=this.nbRotate+"/"+this.nbRotateInit;document.getElementById("nbMenuMagnet").innerHTML=this.nbMagnet+"/"+this.nbMagnetInit};c.prototype.onCanvasMove=function(a){var b=
this.game.canvas,c=a.clientX-document.documentElement.scrollLeft-b.offsetLeft,a=a.clientY-document.documentElement.scrollTop-b.offsetTop;app.js.isDefined(this.entitySelected)&&this.entitySelected.imAlive&&(this.setEntityPosition(c,a),this.game.clear(),this.game.currentMap.draw(this.game.context,!1),this.entitySelected.shape.draw(this.game.context))};c.prototype.onCanvasClick=function(a){var b=this.game.canvas,c=a.clientX-document.documentElement.scrollLeft-b.offsetLeft,a=a.clientY-document.documentElement.scrollTop-
b.offsetTop;if(app.js.isDefined(this.entitySelected))app.js.isDefined(this.entitySelected)&&(this.updateMenuEntities(),this.setEntityPosition(c,a),this.game.currentMap.addEntity(this.entitySelected),this.game.clear(),this.game.currentMap.draw(this.game.context,!1),this.entitySelected=null);else for(var b=this.game.currentMap.staticEntities.length,d=!1,g=0;g<b&&!d;g++){var f=this.game.currentMap.staticEntities[g];this.isClick(f,c,a)&&(d=!0,this.entitySelected=f)}};c.prototype.setEntityPosition=function(a,
b){this.entitySelected.shape.x=a-this.entitySelected.shape.width/2;this.entitySelected.shape.y=b-this.entitySelected.shape.width/2};c.prototype.isClick=function(a,b,c){if(!0===a.isFromMenu){var d=a.shape.x,g=a.shape.y,f=a.shape.height;if(!(d+a.shape.width<b||d>b+1||g+f<c||g>c+1))return!0}return!1};d.Menu=c})();
(function(){window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,50)};var d=document.getElementById("canvas"),c=new app.Game(maps,d);d.width=1024;d.height=600;document.body.appendChild(d);d=new app.Menu(c);c.menu=d;c.init()})();
